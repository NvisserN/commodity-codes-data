<!DOCTYPE html>
<html>
<head>
    <title>Commodity Code Finder</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <style>
        body {
            font-family: Arial, sans-serif;
            line-height: 1.6;
            margin: 0;
            padding: 20px;
            background: #f5f5f5;
        }

        .commodity-finder {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        h1 {
            color: #2196F3;
            margin-top: 0;
            margin-bottom: 20px;
            text-align: center;
        }

        .search-box {
            width: 100%;
            padding: 12px;
            font-size: 16px;
            border: 2px solid #ddd;
            border-radius: 4px;
            margin-bottom: 20px;
            box-sizing: border-box;
            transition: border-color 0.3s ease;
        }

        .search-box:focus {
            border-color: #2196F3;
            outline: none;
        }

        .commodity-result {
            padding: 20px;
            border: 1px solid #ddd;
            margin-bottom: 15px;
            border-radius: 4px;
            background: white;
            transition: all 0.3s ease;
        }

        .commodity-result:hover {
            border-color: #2196F3;
            box-shadow: 0 2px 8px rgba(33,150,243,0.1);
        }

        .commodity-result.excluded {
            border-color: #ff5252;
            background-color: #fff5f5;
        }

        .commodity-result.excluded:hover {
            box-shadow: 0 2px 8px rgba(255,82,82,0.1);
        }

        .commodity-code {
            color: #2196F3;
            margin: 0;
            font-size: 1.2em;
        }

        .excluded .commodity-code {
            color: #ff5252;
        }

        .commodity-description {
            margin: 10px 0;
            color: #333;
        }

        .commodity-meta {
            color: #666;
            font-size: 0.9em;
            margin-top: 5px;
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }

        .commodity-meta span {
            display: inline-flex;
            align-items: center;
        }

        .commodity-meta strong {
            margin-right: 5px;
        }

        #commodityLoadingMessage {
            text-align: center;
            padding: 20px;
            color: #666;
        }

        #commodityErrorMessage {
            text-align: center;
            padding: 20px;
            color: #ff0000;
            background: #fff3f3;
            border-radius: 4px;
            margin: 20px 0;
        }

        .no-results {
            text-align: center;
            padding: 20px;
            color: #666;
            font-style: italic;
            background: #f9f9f9;
            border-radius: 4px;
        }

        .credits {
            text-align: center;
            margin-top: 20px;
            padding-top: 20px;
            border-top: 1px solid #eee;
            color: #666;
            font-size: 0.9em;
        }

        .credits a {
            color: #2196F3;
            text-decoration: none;
        }

        .credits a:hover {
            text-decoration: underline;
        }

        .search-tip {
            text-align: center;
            color: #666;
            font-size: 0.9em;
            margin: -15px 0 15px 0;
        }

        @media (max-width: 600px) {
            body {
                padding: 10px;
            }
            
            .commodity-finder {
                padding: 15px;
            }
            
            .commodity-meta {
                flex-direction: column;
                gap: 5px;
            }
        }
    </style>
</head>
<body>
    <div class="commodity-finder">
        <h1>Commodity Code Finder</h1>
        <div id="commodityLoadingMessage">Loading commodity data...</div>
        <div id="commodityErrorMessage" style="display: none;"></div>
        <div id="commodityContent" style="display: none;">
            <input type="text" 
                   class="search-box" 
                   id="commoditySearchBox" 
                   placeholder="Search by code, description, category, type or material..." 
                   oninput="filterCommodityResults()">
            <div class="search-tip">
                Tip: Use commas to search for multiple terms, e.g. "shirt, katoen" or "metaal, schroef"
            </div>
            <div id="commodityResults"></div>
        </div>
        <div class="credits">
            Made by <a href="https://github.com/NvisserN" target="_blank">Niels Visser</a>
        </div>
    </div>

    <script>
    var commodityData = [];
    var lastSearchTime = 0;
    var searchDelay = 300; // ms delay between searches

    // Synoniemenlijst
    var synonyms = {
        // Materialen
        'schoen': ['schoeisel', 'schoenen'],
        'katoen': ['katoenen'],
        'wol': ['wollen'],
        'zijde': ['zijden'],
        'metaal': ['metalen'],
        'hout': ['houten'],
        'plastic': ['kunststof', 'polymeer', 'polymeren'],
        'staal': ['stalen'],
        'aluminium': ['aluminum'],
        'glas': ['glazen'],
        'papier': ['papieren'],
        'leer': ['lederen', 'leren'],
        'rubber': ['rubberen'],
        'textiel': ['stof', 'stoffen', 'weefsel', 'weefsels'],
        
        // Voedsel
        'melk': ['zuivel', 'dairy'],
        'kaas': ['smeltkaas', 'geraspte kaas'],
        'vis': ['vissen', 'visproducten'],
        'vlees': ['vleeswaren'],
        'groente': ['groenten', 'vegetables'],
        'fruit': ['vruchten', 'fruits'],
        'noot': ['noten', 'nuts'],
        
        // Behandelingen
        'gedroogd': ['droog', 'gedroogde', 'dried'],
        'bevroren': ['frozen', 'diepvries'],
        'vers': ['fresh', 'verse'],
        'gemalen': ['gemaakt', 'poeder', 'fijngemaakt'],
        'gefermenteerd': ['gefermenteerde', 'fermented'],
        
        // Verpakkingen
        'verpakking': ['verpakt', 'verpakkingen'],
        'doos': ['dozen', 'box', 'boxes'],
        'zak': ['zakken', 'bag', 'bags'],
        
        // Maten
        'klein': ['kleine', 'small'],
        'groot': ['grote', 'large'],
        'middel': ['medium', 'middelgroot'],
        
        // Algemeen
        'machine': ['machines', 'apparaat', 'apparaten'],
        'onderdeel': ['onderdelen', 'part', 'parts', 'component'],
        'gereedschap': ['tool', 'tools', 'werktuig', 'werktuigen'],
        'accessoire': ['accessoires', 'toebehoren'],
        'kleding': ['kledingstuk', 'kleren', 'garment'],
        'meubel': ['meubels', 'meubilair', 'furniture']
    };

    function expandSearchTerms(term) {
        term = term.toLowerCase();
        let expanded = [term];
        
        // Check if the term has synonyms
        for (let mainTerm in synonyms) {
            if (term === mainTerm || synonyms[mainTerm].includes(term)) {
                expanded = expanded.concat([mainTerm], synonyms[mainTerm]);
                break;
            }
        }
        
        return expanded;
    }

    function showError(message) {
        document.getElementById('commodityLoadingMessage').style.display = 'none';
        document.getElementById('commodityErrorMessage').style.display = 'block';
        document.getElementById('commodityErrorMessage').innerHTML = message;
        document.getElementById('commodityContent').style.display = 'none';
    }

    function showContent() {
        document.getElementById('commodityLoadingMessage').style.display = 'none';
        document.getElementById('commodityErrorMessage').style.display = 'none';
        document.getElementById('commodityContent').style.display = 'block';
    }

    function loadCommodityData() {
        fetch('commodity_data.json?' + new Date().getTime())
            .then(response => {
                if (!response.ok) {
                    throw new Error('Network response was not ok: ' + response.status);
                }
                return response.json();
            })
            .then(data => {
                commodityData = data;
                showContent();
                filterCommodityResults();
            })
            .catch(error => {
                console.error('Error loading commodity data:', error);
                showError('Error loading commodity data: ' + error.message + '<br><br>Please try again later.');
            });
    }

    function isExcluded(description, searchTerms) {
        const muv = description.toLowerCase().indexOf('m.u.v.');
        if (muv === -1) return false;

        // Check if any search term appears after "m.u.v."
        const textAfterMuv = description.toLowerCase().substring(muv + 6);
        return searchTerms.some(term => textAfterMuv.includes(term));
    }

    function filterCommodityResults() {
        var currentTime = new Date().getTime();
        if (currentTime - lastSearchTime < searchDelay) {
            return;
        }
        lastSearchTime = currentTime;

        var searchText = document.getElementById('commoditySearchBox').value.toLowerCase();
        var resultsDiv = document.getElementById('commodityResults');
        resultsDiv.innerHTML = '';
        
        if (!searchText) {
            resultsDiv.innerHTML = '<div class="no-results">Type to search for commodity codes...</div>';
            return;
        }

        // Split search terms and expand with synonyms
        var searchTerms = searchText.split(',')
            .map(term => term.trim())
            .filter(term => term.length > 0);
        
        // Expand each search term with its synonyms
        var expandedSearchTerms = searchTerms.flatMap(term => expandSearchTerms(term));
        
        var filtered = commodityData.filter(item => {
            // Item matches if ALL original search terms (or their synonyms) are found in ANY of its fields
            return searchTerms.every(searchTerm => {
                const termSynonyms = expandSearchTerms(searchTerm);
                return termSynonyms.some(term =>
                    item.code.toLowerCase().includes(term) ||
                    item.description.toLowerCase().includes(term) ||
                    item.category.toLowerCase().includes(term) ||
                    item.type.toLowerCase().includes(term) ||
                    item.material.toLowerCase().includes(term)
                );
            });
        });
        
        if (filtered.length === 0) {
            resultsDiv.innerHTML = '<div class="no-results">No matching items found</div>';
            return;
        }
        
        filtered.slice(0, 50).forEach(item => {
            var resultItem = document.createElement('div');
            resultItem.className = 'commodity-result' + 
                (isExcluded(item.description, expandedSearchTerms) ? ' excluded' : '');
            
            resultItem.innerHTML = 
                '<h3 class="commodity-code">Code: ' + item.code + '</h3>' +
                '<p class="commodity-description">' + item.description + '</p>' +
                '<div class="commodity-meta">' +
                '<span><strong>Category:</strong> ' + item.category + '</span>' +
                '<span><strong>Type:</strong> ' + item.type + '</span>' +
                '<span><strong>Material:</strong> ' + item.material + '</span>' +
                '</div>';
            resultsDiv.appendChild(resultItem);
        });
        
        if (filtered.length > 50) {
            var moreResults = document.createElement('div');
            moreResults.className = 'no-results';
            moreResults.innerHTML = 'Showing first 50 results. Please refine your search to see more specific items.';
            resultsDiv.appendChild(moreResults);
        }
    }

    // Load data when page loads
    loadCommodityData();
    </script>
</body>
</html>
